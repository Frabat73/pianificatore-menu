<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pianificatore Menu Settimanale</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f2f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            background: #4a90e2;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        .tab.active {
            background: #4a90e2;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .targets {
            display: flex;
            justify-content: space-around;
            background: #e8f4fd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .target-item {
            text-align: center;
        }
        .target-item h4 {
            margin: 0;
            color: #333;
        }
        .target-item .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4a90e2;
        }
        .target-item .percentage {
            font-size: 0.9em;
            color: #666;
        }
        .week-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .week-btn {
            padding: 10px 15px;
            border: 2px solid #4a90e2;
            background: white;
            color: #4a90e2;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        .week-btn.active {
            background: #4a90e2;
            color: white;
        }
        .days-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .day-card {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
        }
        .day-header {
            background: #4a90e2;
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .meal {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .meal-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        .food-item {
            background: #f8f9fa;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .food-name {
            width: 60%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin-right: 5px;
        }
        .food-qty {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin-right: 5px;
        }
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 3px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .food-info {
            font-size: 0.8em;
            color: #666;
            margin-top: 3px;
        }
        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            width: 100%;
            margin-top: 5px;
        }
        .day-summary {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.8em;
        }
        .day-summary h4 {
            margin: 0 0 8px 0;
            color: #495057;
        }
        .total-item {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
        }
        .charts-container {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff, #e8f4fd);
            border-radius: 15px;
        }
        .chart-wrapper {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .chart-wrapper h4 {
            margin: 0 0 15px 0;
            color: #4a90e2;
        }
        .chart-canvas {
            width: 250px !important;
            height: 250px !important;
        }
        .summary {
            background: #d4edda;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .summary-item h4 {
            margin: 0;
            color: #155724;
        }
        .summary-item .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #28a745;
        }
        .foods-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .foods-table th, .foods-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .foods-table th {
            background: #4a90e2;
            color: white;
        }
        .foods-table tr:nth-child(even) {
            background: #f2f2f2;
        }
        .add-food-form {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .add-food-form input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 120px;
        }
        .search-box {
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            font-size: 16px;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 10px;
            }
            .targets {
                flex-direction: column;
                gap: 10px;
            }
            .week-selector {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }
            .week-btn {
                padding: 8px 10px;
                font-size: 0.8em;
            }
            .days-container {
                grid-template-columns: 1fr;
            }
            .charts-container {
                flex-direction: column;
                gap: 20px;
            }
            .chart-canvas {
                width: 200px !important;
                height: 200px !important;
            }
            .summary-stats {
                flex-direction: column;
                gap: 10px;
            }
            .food-name {
                width: 50%;
            }
            .add-food-form {
                text-align: center;
            }
            .add-food-form input {
                width: 90%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Pianificatore Menu Settimanale</h1>
            <p>Piano alimentare da 1250 calorie per 8 settimane</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('planner')">üìÖ Pianificatore</button>
            <button class="tab" onclick="showTab('database')">üìä Database Alimenti</button>
        </div>

        <div id="planner" class="tab-content active">
            <div class="targets">
                <div class="target-item">
                    <h4>Calorie Target</h4>
                    <div class="value">1250</div>
                </div>
                <div class="target-item">
                    <h4>Carboidrati</h4>
                    <div class="value">172g</div>
                    <div class="percentage">(55%)</div>
                </div>
                <div class="target-item">
                    <h4>Proteine</h4>
                    <div class="value">63g</div>
                    <div class="percentage">(20%)</div>
                </div>
                <div class="target-item">
                    <h4>Grassi</h4>
                    <div class="value">35g</div>
                    <div class="percentage">(25%)</div>
                </div>
            </div>

            <div class="week-selector">
                <button class="week-btn active" onclick="selectWeek(1)">Settimana 1</button>
                <button class="week-btn" onclick="selectWeek(2)">Settimana 2</button>
                <button class="week-btn" onclick="selectWeek(3)">Settimana 3</button>
                <button class="week-btn" onclick="selectWeek(4)">Settimana 4</button>
                <button class="week-btn" onclick="selectWeek(5)">Settimana 5</button>
                <button class="week-btn" onclick="selectWeek(6)">Settimana 6</button>
                <button class="week-btn" onclick="selectWeek(7)">Settimana 7</button>
                <button class="week-btn" onclick="selectWeek(8)">Settimana 8</button>
            </div>

            <div class="days-container" id="daysContainer">
            </div>

            <div class="summary">
                <h2>üìä Riepilogo - <span id="currentWeekTitle">Settimana 1</span></h2>
                <div class="summary-stats">
                    <div class="summary-item">
                        <h4>Calorie Medie</h4>
                        <div class="value" id="avgCal">0</div>
                    </div>
                    <div class="summary-item">
                        <h4>Proteine Medie</h4>
                        <div class="value" id="avgProt">0g</div>
                    </div>
                    <div class="summary-item">
                        <h4>Carb. Medi</h4>
                        <div class="value" id="avgCarbs">0g</div>
                    </div>
                    <div class="summary-item">
                        <h4>Grassi Medi</h4>
                        <div class="value" id="avgFat">0g</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="database" class="tab-content">
            <div class="add-food-form">
                <h3>‚ûï Aggiungi Nuovo Alimento</h3>
                <input type="text" id="newFoodName" placeholder="Nome alimento">
                <input type="number" id="newFoodCal" placeholder="Calorie per 100g">
                <input type="number" id="newFoodProt" placeholder="Proteine per 100g">
                <input type="number" id="newFoodCarbs" placeholder="Carboidrati per 100g">
                <input type="number" id="newFoodFat" placeholder="Grassi per 100g">
                <button onclick="addNewFood()" style="padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                    Aggiungi Alimento
                </button>
            </div>

            <input type="text" id="searchFood" class="search-box" placeholder="üîç Cerca alimento..." onkeyup="searchFoods()">
            
            <table class="foods-table">
                <thead>
                    <tr>
                        <th>Alimento</th>
                        <th>Calorie (100g)</th>
                        <th>Proteine (g)</th>
                        <th>Carboidrati (g)</th>
                        <th>Grassi (g)</th>
                        <th>Azioni</th>
                    </tr>
                </thead>
                <tbody id="foodsTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        let foods = {
            'pane': {cal: 250, prot: 8, carbs: 50, fat: 1},
            'pasta': {cal: 350, prot: 12, carbs: 70, fat: 2},
            'riso': {cal: 350, prot: 7, carbs: 75, fat: 1},
            'pollo': {cal: 165, prot: 31, carbs: 0, fat: 4},
            'manzo': {cal: 250, prot: 26, carbs: 0, fat: 15},
            'salmone': {cal: 200, prot: 25, carbs: 0, fat: 12},
            'uova': {cal: 155, prot: 13, carbs: 1, fat: 11},
            'latte': {cal: 60, prot: 3, carbs: 5, fat: 3},
            'yogurt': {cal: 60, prot: 4, carbs: 4, fat: 4},
            'mozzarella': {cal: 280, prot: 19, carbs: 1, fat: 22},
            'fagioli': {cal: 100, prot: 8, carbs: 17, fat: 1},
            'lenticchie': {cal: 115, prot: 9, carbs: 16, fat: 0},
            'ceci': {cal: 160, prot: 9, carbs: 27, fat: 3},
            'tofu': {cal: 76, prot: 8, carbs: 2, fat: 5},
            'pomodori': {cal: 18, prot: 1, carbs: 4, fat: 0},
            'spinaci': {cal: 23, prot: 3, carbs: 4, fat: 0},
            'broccoli': {cal: 34, prot: 3, carbs: 7, fat: 0},
            'carote': {cal: 41, prot: 1, carbs: 10, fat: 0},
            'banana': {cal: 89, prot: 1, carbs: 23, fat: 0},
            'mela': {cal: 52, prot: 0, carbs: 14, fat: 0},
            'olio': {cal: 884, prot: 0, carbs: 0, fat: 100}
        };

        const days = ['Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato', 'Domenica'];
        const meals = ['Colazione', 'Spuntino', 'Pranzo', 'Merenda', 'Cena'];
        let mealData = {};
        let currentWeek = 1;
        let targetChart = null;
        let weeklyChart = null;

        function initData() {
            const savedData = localStorage.getItem('pianificatore-menu');
            if (savedData) {
                mealData = JSON.parse(savedData);
            } else {
                for (let week = 1; week <= 8; week++) {
                    mealData['week' + week] = {};
                    days.forEach(day => {
                        mealData['week' + week][day] = {};
                        meals.forEach(meal => {
                            mealData['week' + week][day][meal] = [];
                        });
                    });
                }
            }
            
            const savedFoods = localStorage.getItem('pianificatore-foods');
            if (savedFoods) {
                foods = JSON.parse(savedFoods);
            }
        }

        function saveData() {
            localStorage.setItem('pianificatore-menu', JSON.stringify(mealData));
            localStorage.setItem('pianificatore-foods', JSON.stringify(foods));
        }

        function selectWeek(weekNumber) {
            document.querySelectorAll('.week-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            currentWeek = weekNumber;
            document.getElementById('currentWeekTitle').textContent = 'Settimana ' + weekNumber;
            
            createDays();
        }

        function createDays() {
            const container = document.getElementById('daysContainer');
            container.innerHTML = '';

            days.forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-card';
                dayDiv.innerHTML = '<div class="day-header">' + day + '</div>' +
                    meals.map(meal => 
                        '<div class="meal">' +
                        '<div class="meal-title">' + meal + '</div>' +
                        '<div id="' + day + '-' + meal + '"></div>' +
                        '<button class="add-btn" onclick="addFood(\'' + day + '\', \'' + meal + '\')">+ Aggiungi cibo</button>' +
                        '</div>'
                    ).join('') +
                    '<div class="day-summary" id="summary-' + day + '">' +
                    '<h4>üìä Totali del Giorno</h4>' +
                    '<div id="totals-' + day + '">' +
                    '<div class="total-item"><span>Calorie:</span><span>0 kcal (0%)</span></div>' +
                    '<div class="total-item"><span>Proteine:</span><span>0g (0%)</span></div>' +
                    '<div class="total-item"><span>Carboidrati:</span><span>0g (0%)</span></div>' +
                    '<div class="total-item"><span>Grassi:</span><span>0g (0%)</span></div>' +
                    '</div>' +
                    '</div>';
                container.appendChild(dayDiv);
                
                const weekData = mealData['week' + currentWeek][day];
                meals.forEach(meal => {
                    if (weekData[meal] && weekData[meal].length > 0) {
                        weekData[meal].forEach(item => recreateFood(item, day, meal));
                    }
                });
            });

            const chartsDiv = document.createElement('div');
            chartsDiv.className = 'charts-container';
            chartsDiv.innerHTML = 
                '<div class="chart-wrapper">' +
                '<h4>üéØ Target Nutrizionali</h4>' +
                '<canvas id="targetChart" class="chart-canvas"></canvas>' +
                '</div>' +
                '<div class="chart-wrapper">' +
                '<h4>üìä Risultati Settimana ' + currentWeek + '</h4>' +
                '<canvas id="weeklyChart" class="chart-canvas"></canvas>' +
                '</div>';
            container.appendChild(chartsDiv);

            days.forEach(day => updateDaySummary(day));
            updateSummary();
            createCharts();
        }

        function recreateFood(item, day, meal) {
            const foodDiv = document.createElement('div');
            foodDiv.className = 'food-item';
            foodDiv.innerHTML = 
                '<input type="text" class="food-name" value="' + item.name + '" onchange="updateFood(\'' + item.id + '\', \'' + day + '\', \'' + meal + '\')" id="name-' + item.id + '">' +
                '<input type="number" class="food-qty" value="' + item.qty + '" onchange="updateFood(\'' + item.id + '\', \'' + day + '\', \'' + meal + '\')" id="qty-' + item.id + '">' +
                '<span>g</span>' +
                '<button class="remove-btn" onclick="removeFood(\'' + item.id + '\', \'' + day + '\', \'' + meal + '\')">√ó</button>' +
                '<div class="food-info" id="info-' + item.id + '">' +
                item.nutrition.cal + ' kcal | P: ' + item.nutrition.prot + 'g | C: ' + item.nutrition.carbs + 'g | G: ' + item.nutrition.fat + 'g' +
                '</div>';
            foodDiv.id = 'food-' + item.id;
            document.getElementById(day + '-' + meal).appendChild(foodDiv);
        }

        function addFood(day, meal) {
            const id = Date.now().toString();
            const foodDiv = document.createElement('div');
            foodDiv.className = 'food-item';
            foodDiv.innerHTML = 
                '<input type="text" class="food-name" placeholder="Nome cibo" onchange="updateFood(\'' + id + '\', \'' + day + '\', \'' + meal + '\')" id="name-' + id + '">' +
                '<input type="number" class="food-qty" value="100" onchange="updateFood(\'' + id + '\', \'' + day + '\', \'' + meal + '\')" id="qty-' + id + '">' +
                '<span>g</span>' +
                '<button class="remove-btn" onclick="removeFood(\'' + id + '\', \'' + day + '\', \'' + meal + '\')">√ó</button>' +
                '<div class="food-info" id="info-' + id + '">Inserisci il nome del cibo</div>';
            foodDiv.id = 'food-' + id;
            document.getElementById(day + '-' + meal).appendChild(foodDiv);
            
            mealData['week' + currentWeek][day][meal].push({
                id: id,
                name: '',
                qty: 100,
                nutrition: {cal: 0, prot: 0, carbs: 0, fat: 0}
            });
            
            saveData();
        }

        function updateFood(id, day, meal) {
            const name = document.getElementById('name-' + id).value.toLowerCase();
            const qty = parseFloat(document.getElementById('qty-' + id).value) || 100;
            
            const item = mealData['week' + currentWeek][day][meal].find(item => item.id === id);
            if (!item) return;

            item.name = name;
            item.qty = qty;

            if (foods[name]) {
                const multiplier = qty / 100;
                item.nutrition = {
                    cal: Math.round(foods[name].cal * multiplier),
                    prot: Math.round(foods[name].prot * multiplier * 10) / 10,
                    carbs: Math.round(foods[name].carbs * multiplier * 10) / 10,
                    fat: Math.round(foods[name].fat * multiplier * 10) / 10
                };

                document.getElementById('info-' + id).innerHTML = 
                    item.nutrition.cal + ' kcal | P: ' + item.nutrition.prot + 'g | C: ' + item.nutrition.carbs + 'g | G: ' + item.nutrition.fat + 'g';
            } else if (name) {
                document.getElementById('info-' + id).innerHTML = 'Cibo non trovato';
            }

            updateDaySummary(day);
            updateSummary();
            updateCharts();
            saveData();
        }

        function removeFood(id, day, meal) {
            document.getElementById('food-' + id).remove();
            mealData['week' + currentWeek][day][meal] = mealData['week' + currentWeek][day][meal].filter(item => item.id !== id);
            updateDaySummary(day);
            updateSummary();
            updateCharts();
            saveData();
        }

        function updateDaySummary(day) {
            let dayCal = 0, dayProt = 0, dayCarbs = 0, dayFat = 0;
            
            meals.forEach(meal => {
                if (mealData['week' + currentWeek][day][meal]) {
                    mealData['week' + currentWeek][day][meal].forEach(food => {
                        dayCal += food.nutrition.cal || 0;
                        dayProt += food.nutrition.prot || 0;
                        dayCarbs += food.nutrition.carbs || 0;
                        dayFat += food.nutrition.fat || 0;
                    });
                }
            });

            const calPerc = Math.round((dayCal / 1250) * 100);
            const protPerc = Math.round((dayProt / 63) * 100);
            const carbsPerc = Math.round((dayCarbs / 172) * 100);
            const fatPerc = Math.round((dayFat / 35) * 100);

            const totalsDiv = document.getElementById('totals-' + day);
            if (totalsDiv) {
                totalsDiv.innerHTML = 
                    '<div class="total-item"><span>Calorie:</span><span>' + dayCal + ' kcal (' + calPerc + '%)</span></div>' +
                    '<div class="total-item"><span>Proteine:</span><span>' + dayProt.toFixed(1) + 'g (' + protPerc + '%)</span></div>' +
                    '<div class="total-item"><span>Carboidrati:</span><span>' + dayCarbs.toFixed(1) + 'g (' + carbsPerc + '%)</span></div>' +
                    '<div class="total-item"><span>Grassi:</span><span>' + dayFat.toFixed(1) + 'g (' + fatPerc + '%)</span></div>';
            }
        }

        function updateSummary() {
            let totalCal = 0, totalProt = 0, totalCarbs = 0, totalFat = 0;
            let dayCount = 0;

            days.forEach(day => {
                let dayCal = 0, dayProt = 0, dayCarbs = 0, dayFat = 0;
                
                meals.forEach(meal => {
                    if (mealData['week' + currentWeek][day][meal]) {
                        mealData['week' + currentWeek][day][meal].forEach(food => {
                            dayCal += food.nutrition.cal || 0;
                            dayProt += food.nutrition.prot || 0;
                            dayCarbs += food.nutrition.carbs || 0;
                            dayFat += food.nutrition.fat || 0;
                        });
                    }
                });

                if (dayCal > 0) {
                    totalCal += dayCal;
                    totalProt += dayProt;
                    totalCarbs += dayCarbs;
                    totalFat += dayFat;
                    dayCount++;
                }
            });

            if (dayCount > 0) {
                document.getElementById('avgCal').textContent = Math.round(totalCal / dayCount);
                document.getElementById('avgProt').textContent = Math.round(totalProt / dayCount) + 'g';
                document.getElementById('avgCarbs').textContent = Math.round(totalCarbs / dayCount) + 'g';
                document.getElementById('avgFat').textContent = Math.round(totalFat / dayCount) + 'g';
            }
        }

        function createCharts() {
            if (targetChart) targetChart.destroy();
            if (weeklyChart) weeklyChart.destroy();

            const targetCtx = document.getElementById('targetChart').getContext('2d');
            targetChart = new Chart(targetCtx, {
               type: 'pie',
               data: {
                   labels: ['Carboidrati (55%)', 'Proteine (20%)', 'Grassi (25%)'],
                   datasets: [{
                       data: [55, 20, 25],
                       backgroundColor: ['#FFB84D', '#4FACFE', '#FF6B9D'],
                       borderWidth: 2,
                       borderColor: '#fff'
                   }]
               },
               options: {
                   responsive: false,
                   maintainAspectRatio: false,
                   plugins: {
                       legend: { position: 'bottom' }
                   }
               }
           });

           let totalCal = 0, totalProt = 0, totalCarbs = 0, totalFat = 0;
           days.forEach(day => {
               meals.forEach(meal => {
                   if (mealData['week' + currentWeek][day][meal]) {
                       mealData['week' + currentWeek][day][meal].forEach(food => {
                           totalCal += food.nutrition.cal || 0;
                           totalProt += food.nutrition.prot || 0;
                           totalCarbs += food.nutrition.carbs || 0;
                           totalFat += food.nutrition.fat || 0;
                       });
                   }
               });
           });

           const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
           
           if (totalCal === 0) {
               weeklyChart = new Chart(weeklyCtx, {
                   type: 'pie',
                   data: {
                       labels: ['Nessun dato'],
                       datasets: [{
                           data: [100],
                           backgroundColor: ['#e0e0e0'],
                           borderWidth: 2,
                           borderColor: '#fff'
                       }]
                   },
                   options: {
                       responsive: false,
                       maintainAspectRatio: false,
                       plugins: {
                           legend: { position: 'bottom' }
                       }
                   }
               });
           } else {
               const carbsPerc = Math.round((totalCarbs * 4 / totalCal) * 100);
               const protPerc = Math.round((totalProt * 4 / totalCal) * 100);
               const fatPerc = Math.round((totalFat * 9 / totalCal) * 100);

               weeklyChart = new Chart(weeklyCtx, {
                   type: 'pie',
                   data: {
                       labels: ['Carboidrati (' + carbsPerc + '%)', 'Proteine (' + protPerc + '%)', 'Grassi (' + fatPerc + '%)'],
                       datasets: [{
                           data: [carbsPerc, protPerc, fatPerc],
                           backgroundColor: ['#FFB84D', '#4FACFE', '#FF6B9D'],
                           borderWidth: 2,
                           borderColor: '#fff'
                       }]
                   },
                   options: {
                       responsive: false,
                       maintainAspectRatio: false,
                       plugins: {
                           legend: { position: 'bottom' }
                       }
                   }
               });
           }
       }

       function updateCharts() {
           createCharts();
       }

       function showTab(tabName) {
           document.querySelectorAll('.tab-content').forEach(content => {
               content.classList.remove('active');
           });
           
           document.querySelectorAll('.tab').forEach(tab => {
               tab.classList.remove('active');
           });
           
           document.getElementById(tabName).classList.add('active');
           event.target.classList.add('active');
           
           if (tabName === 'database') {
               populateFoodsTable();
           }
       }

       function populateFoodsTable() {
           const tbody = document.getElementById('foodsTableBody');
           tbody.innerHTML = '';
           
           Object.keys(foods).forEach(foodName => {
               const food = foods[foodName];
               const row = tbody.insertRow();
               row.innerHTML = 
                   '<td style="text-transform: capitalize;">' + foodName + '</td>' +
                   '<td>' + food.cal + '</td>' +
                   '<td>' + food.prot + '</td>' +
                   '<td>' + food.carbs + '</td>' +
                   '<td>' + food.fat + '</td>' +
                   '<td>' +
                   '<button onclick="deleteFood(\'' + foodName + '\')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">' +
                   'Elimina' +
                   '</button>' +
                   '</td>';
           });
       }

       function addNewFood() {
           const name = document.getElementById('newFoodName').value.toLowerCase().trim();
           const cal = parseFloat(document.getElementById('newFoodCal').value);
           const prot = parseFloat(document.getElementById('newFoodProt').value);
           const carbs = parseFloat(document.getElementById('newFoodCarbs').value);
           const fat = parseFloat(document.getElementById('newFoodFat').value);
           
           if (!name || isNaN(cal) || isNaN(prot) || isNaN(carbs) || isNaN(fat)) {
               alert('Compila tutti i campi!');
               return;
           }
           
           foods[name] = { cal: cal, prot: prot, carbs: carbs, fat: fat };
           
           document.getElementById('newFoodName').value = '';
           document.getElementById('newFoodCal').value = '';
           document.getElementById('newFoodProt').value = '';
           document.getElementById('newFoodCarbs').value = '';
           document.getElementById('newFoodFat').value = '';
           
           populateFoodsTable();
           saveData();
           alert('Alimento "' + name + '" aggiunto!');
       }

       function deleteFood(foodName) {
           if (confirm('Eliminare "' + foodName + '"?')) {
               delete foods[foodName];
               populateFoodsTable();
               saveData();
               alert('"' + foodName + '" eliminato!');
           }
       }

       function searchFoods() {
           const searchTerm = document.getElementById('searchFood').value.toLowerCase();
           const rows = document.getElementById('foodsTableBody').getElementsByTagName('tr');
           
           for (let i = 0; i < rows.length; i++) {
               const foodName = rows[i].getElementsByTagName('td')[0].textContent.toLowerCase();
               rows[i].style.display = foodName.includes(searchTerm) ? '' : 'none';
           }
       }

       document.addEventListener('DOMContentLoaded', function() {
           initData();
           createDays();
           populateFoodsTable();
       });
   </script>
</body>
</html>
